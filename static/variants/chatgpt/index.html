<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Resume — ChatGPT Variant</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* Namespaced styles to avoid leaking */
    #app-chatgpt { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; background:#fafafa; color:#111; padding:16px; }
    #app-chatgpt .card { background:#fff; border:1px solid #e5e5e5; border-radius:12px; padding:16px; margin:12px 0; box-shadow:0 1px 0 rgba(0,0,0,.03); }
    #app-chatgpt h1 { font-size:28px; margin:0 0 6px 0; }
    #app-chatgpt h2 { font-size:14px; letter-spacing:.06em; text-transform:uppercase; margin:16px 0 8px; color:#555; }
    #app-chatgpt .chips { display:flex; flex-wrap:wrap; gap:8px; }
    #app-chatgpt .chip { border:1px solid #e5e5e5; border-radius:999px; padding:4px 8px; font-size:12px; }
    #app-chatgpt a { color:#0b62ff; text-decoration:none; }
  </style>
</head>
<body>
  <div id="app-chatgpt">
    <div class="card" id="header">
      <h1 id="name">Loading…</h1>
      <div id="label" style="color:#555;"></div>
      <div id="links" style="margin-top:6px; display:flex; gap:12px; flex-wrap:wrap;"></div>
    </div>

    <div class="card">
      <h2>Summary</h2>
      <div id="summary"></div>
    </div>

    <div class="card">
      <h2>Experience</h2>
      <div id="work"></div>
    </div>

    <div class="card">
      <h2>Skills</h2>
      <div id="skills" class="chips"></div>
    </div>
  </div>

  <script>
    async function render() {
      const res = await fetch('/data/resume.json');
      const data = await res.json();

      const byId = (id) => document.getElementById(id);
      byId('name').textContent = data.basics?.name || 'Your Name';
      byId('label').textContent = data.basics?.label || '';
      const links = [];
      if (data.basics?.website) links.push(`<a href="${data.basics.website}" target="_blank" rel="noopener">Website</a>`);
      if (data.basics?.email) links.push(`<a href="mailto:${data.basics.email}">${data.basics.email}</a>`);
      const gh = data.basics?.profiles?.find(p => (p.network||'').toLowerCase()==='github');
      if (gh) links.push(`<a href="${gh.url}" target="_blank" rel="noopener">GitHub</a>`);
      const li = data.basics?.profiles?.find(p => (p.network||'').toLowerCase()==='linkedin');
      if (li) links.push(`<a href="${li.url}" target="_blank" rel="noopener">LinkedIn</a>`);
      byId('links').innerHTML = links.join(' · ');

      byId('summary').textContent = data.basics?.summary || '';

      const work = (data.work||[]).map(j => {
        const when = j.endDate ? `${j.startDate} – ${j.endDate}` : `${j.startDate} – Present`;
        const hi = (j.highlights||[]).map(x => `<li>${x}</li>`).join('');
        return `
          <div style="margin:10px 0;">
            <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;">
              <strong>${j.position}</strong> @ ${j.name}
              <span style="color:#666;">${when}</span>
            </div>
            ${j.summary ? `<div style="margin:4px 0 0;">${j.summary}</div>` : ''}
            ${hi ? `<ul style="margin:6px 0 0 18px;">${hi}</ul>` : ''}
          </div>`;
      }).join('');
      byId('work').innerHTML = work;

      const skills = (data.skills||[]).map(s => `<span class="chip">${s.name}${s.keywords?.length ? ' — ' + s.keywords.join(', ') : ''}</span>`).join('');
      byId('skills').innerHTML = skills;

      // Inform parent iframe of height
      requestAnimationFrame(() => {
        const h = document.documentElement.scrollHeight;
        window.parent && window.parent.postMessage({ type: 'variant:height', value: h }, '*');
      });
    }
    render();
  </script>
</body>
</html>